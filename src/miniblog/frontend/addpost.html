<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />

<link rel="stylesheet" type="text/css" href="css/bootstrap.css">
<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="css/addpost.css">

<script src="js/jquery-1.11.2.min.js"></script>
<script src="js/getCookie.js"></script>
<script src="js/displayuser.js"></script>
<script src="js/logout.js"></script>   
<script src="js/tinymce.min.js"></script>
<script src="js/tinymce.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/bootstrap.js"></script>

</head>
<body>
	<div class="container">
		<div class="group1">
			<div classs="row">
				<div class="col-xs-3 col-sm-3 col-md-3 miniblog">
					<a class="remove-underline" href="home.html"><span class="logo-color">Mini Blog</span></a>
				</div>
				<div class="col-xs-3 col-sm-3 col-md-3 pull-right">	
					<span>Hi <a href="updateuser.html" id="user"></a><span>
					<span><a href="#" onclick="logout()"">Logout</a></span>
					<br/>
					<span><a href="changepass.html">Change password</a></span>	
				</div>				
			</div>
		</div>
		<div class="group2">
			<!-- Navigation -->
			<div class="navbar navbar-default nav-area">
				<div class="container-fluid">
					<div class="navbar-header">
						<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".mynavbar-content">
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
						</button>
						<!-- <a class="remove-underline navbar-brand" href="#"><span>Miniblog</span></a> -->
					</div>
					<div class="collapse navbar-collapse  mynavbar-content">
						<ul class=" navbar-nav breadcrumb">
							<li><a class="remove-underline" href="home.html">Home</a></li>
							<li class="active"><a class="remove-underline" href="addpost.html">New post</a></li>
							<li><a class="remove-underline" href="userpost.html">User's posts</a></li>
							<li><a class="remove-underline" href="allpost.html">All posts</a></li>
						</ul>
					</div>
				</div>
			</div>
		</div>

		<hr>

		<div class="group3 col-xs-offset-1">
			<div class="row">
				<div class="col-xs-4 col-xs-offset-4">
					<h2><span>New Post</span></h2>
					<br/>
				</div>
			</div>
			<div class="row">
				<div id="frm-change-pass" class="form-group">
					<div class="col-xs-3 inline-block move-down">
						<span>Image</span>
					</div>	
					<div class="col-xs-9 inline-block  move-down">
						<div class="row">
							<div class="col-xs-10">
								<input type="text" class="form-control" placeholder="Url..." />
							</div>
							<div class="col-xs-1 cog">
								<a href="#"><span class="glyphicon glyphicon-cog"></span></a>
							</div>
						</div>
					</div>
					<div class="col-xs-3 inline-block move-down">
						<span>Title</span>
					</div>
					<div class="col-xs-9 inline-block  move-down">
						<input id="title" type="text" class="form-control" placeholder="Enter post's title..." />
					</div>
					<div class="col-xs-3 inline-block move-down">
						<span>Description</span>
					</div>
					<div class="col-xs-9 inline-block  move-down">
						<input id="description" class="form-control" rows="2" id="description" placeholder="Enter post's description..."></input>
					</div>
					<div class="col-xs-3 inline-block move-down">
						<span>Content</span>
					</div>
					<div class="col-xs-9 inline-block  move-down">
						<textarea name="content" id="content" class="form-control" placeholder="Enter post's content..."></textarea>
					</div>
					<div class="inline-block move-left move-down">
						<button id="postbutton" class="btn btn-default">Post</button>
					</div>
					<div class="inline-block">
						<button id="cancel" class="btn btn-default">Cancel</button>
					</div>
				</div>

			</div>
			
		</div>		
	</div>

<script type="text/javascript">
    
    // Create new post
    $("#postbutton").click(function() {
        var title = $("#title").val();
        var description = $("#description").val();
        var content = tinyMCE.get('content').getContent();
        var image = $("#image").val();

        title = $.trim(title);
        description = $.trim(description);

        // Validate
        $(".error").hide();
        var hasError = false;

        if (title == '') {
            $("#title").after('<span class="error">Enter title of post.</span>');
            hasError = true;
        }
        else if (description == '') {
                $("#description").after('<span class="error">Enter description of post.</span>');
                hasError = true;
            }
            else if (content == '') {
                $("#content").after('<span class="error">Enter content of post</span>');
                hasError = true;
            }
        if (hasError == true) {
            return false;
        }
        
        $.ajax({
            type: "POST",
            beforeSend: function(request) {
                request.setRequestHeader("access_token", getCookie('token'));
            },
            url: "http://localhost:8080/miniblog/v1/posts/create",
            contentType: "application/json",
            data: JSON.stringify({'title': title, 'description': description, 'content': content, 'image': image}),
            statusCode: {
                1001: function() {
                    alert("Input failed.");
                },
                9002: function() {
                    alert("Missing token. Please login");
                    window.location = 'welcome.html';
                    return;
                },
                1002: function() {
                    alert("Token has expired.");
                    window.location = 'welcome.html';
                    return;
                },
                9001: function() {
                    alert("Error.");
                    window.location.reload();
                    return;
                }
            },
            success: function(response, status, xhr) {
                if (status == "success") {
                    alert("New post created success.");
                    window.location = 'home.html';
                }
            }
        
        })

    })
    
    $("#cancel").click(function() {
        window.location.reload();
        return;
    })
    
    
    
</script>            
            
            

</body>
</html>