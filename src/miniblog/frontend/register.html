<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />

<link rel="stylesheet" type="text/css" href="css/bootstrap.css">
<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="css/register.css">

<script src="js/jquery-1.11.2.min.js"></script>    
<script src="js/bootstrap.min.js"></script>
<script src="js/bootstrap.js"></script>

</head>
<body>
	<div class="container">
		<div class="group1">
			<div classs="row">
				<div class="col-xs-3 col-sm-3 col-md-3 miniblog">
					<a class="remove-underline" href="welcome.html"><span class="logo-color">Mini Blog</span></a>
				</div>
				<div class="col-xs-3 col-sm-3 col-md-3 pull-right">	
					<span>Hi Guest</a><span>
				</div>				
			</div>
		</div>
		<!-- Navigator -->
		<div class="group2 navbar navbar-default nav-area">
			<div class="container-fluid">
				<div class="navbar-header">
					<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".mynavbar-content">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</button>
					<!-- <a class="remove-underline navbar-brand" href="#"><span>Miniblog</span></a> -->
				</div>
				<div class="collapse navbar-collapse mynavbar-content">
					<ul class=" navbar-nav breadcrumb">
						<li><a class="remove-underline" href="welcome.html">Welcome</a></li>
					</ul>
				</div>
			</div>
		</div>
		<hr>

		<div class="group3 col-xs-offset-2">
			<div class="row">
				<div class="col-xs-4 col-xs-offset-3">
					<h2><span>Register</span></h2>
					<br/>
				</div>
			</div>
			<div class="row">
				<div class="col-xs-5 col-xs-offset-2">
				</div>
			</div>
			<div class="row">
				<div id="frm-change-pass">
                    <div class="form-control-group">
					<div class="col-xs-4 inline-block move-down">
						<span>Username</span>
					</div>
					<div class="col-xs-8 inline-block  move-down">
						<input id="username" type="text" class="form-control" placeholder="Enter username..."  />
					</div>
                    </div>
                    <div class="form-control-group">
					<div class="col-xs-4  inline-block move-down">
						<span>First name</span>
					</div>
					<div class="col-xs-8 inline-block  move-down">
						<input id="firstname" type="text" class="form-control" placeholder="Enter first name..."  />
					</div>
                    </div>
                    <div class="form-group">
					<div class="col-xs-4  inline-block move-down">
						<span>Last name</span>
					</div>
					<div class="col-xs-8  inline-block  move-down">
						<input id="lastname" type="text" class="form-control" placeholder="Enter last name..."  />
					</div>
                    </div>
                    <div class="form-group">
					<div class="col-xs-4  inline-block move-down">
						<span>Email</span>
					</div>
					<div class="col-xs-8  inline-block  move-down">
						<input id="email" type="text" class="form-control" placeholder="Enter email..."  />
					</div>
                    </div>
                    <div class="form-group">
					<div class="col-xs-4  inline-block move-down">
						<span>Password</span>
					</div>
					<div class="col-xs-8  inline-block  move-down">
						<input id="password" type="password" class="form-control" placeholder="Enter password..."  />
					</div>
                    </div>
                    <div class="form-group">
					<div class="col-xs-4  inline-block move-down">
						<span>Confirm password</span>
					</div>
					<div class="col-xs-8  inline-block  move-down">
						<input id="confirmPassword" type="password" class="form-control" placeholder="Enter confirm pass..."  />
					</div>
                    </div>
                    <div class="form-group">
					<div class="col-xs-4 inline-block move-down">
						<span>Image</span>
					</div>
					<div class="col-xs-8 inline-block  move-down">
						<div class="row">
							<div class="col-xs-10">
								<input id="image" type="text" class="form-control" placeholder="url..." />
							</div>
							<div class="col-xs-1 cog">
								<a href="#"><span class="glyphicon glyphicon-cog"></span></a>
							</div>
						</div>
					</div>
                    </div>
                    <div class="form-group">
					<div class="col-xs-offset-3 inline-block move-right">
						<button id="register" class="btn btn-default">Register</button>
					</div>
					<div class="inline-block">
						<button id="cancel" class="btn btn-default">Cancel</button>
					</div>
                    </div>
				</div>
			</div>
		</div>	
	</div>		
</div>

<script type="text/javascript">
    
    // Register user's info
    $("#register").click(function() {
        // Get user's data
        var username = $("#username").val();
        var firstname = $("#firstname").val();
        var lastname = $("#lastname").val();
        var email = $("#email").val();
        var password = $("#password").val();
        var confirmPassword = $("#confirmPassword").val();
        var image = $("#image").val();
        
        username = $.trim(username);
        firstname = $.trim(firstname);
        lastname = $.trim(lastname);
        email = $.trim(email);
        password = $.trim(password);
        confirmPassword = $.trim(confirmPassword);

        // Validate
        $(".error").hide();
        var hasError = false;
        var emailRegex = "^[\\w-_+]*[\\.]?[\\w-_\\.]\\@([\\w]+\\.)+[\\w]+[\\w]$";
        var charRule = "[a-zA-Z0-9 ]*";

        if (username == '') {
            $("#username").after('<span class="error">Enter your username</span>');
            hasError = true;
        }
        else if (!username.match(charRule)) {
            $("#username").after('<span class="error">Characters only consist of a-z, A-Z, 0-9</span>');
            hasError = true;
        }
        else if (username.length < 2) {
            $("#username").after('<span class="error">Username must be at least 2 characters</span>');
            hasError = true;
        }
        else if (username.length > 45) {
            $("#username").after('<span class="error">Username can not exceed 45 characters</span>');
            hasError = true;
        }
        else if (firstname == '') {
            $("#firstname").after('<span class="error">Enter your first name</span>');
            hasError = true;
        }        
        else if (!firstname.match(charRule)) {
            $("#firstname").after('<span class="error">Characters only consist of a-z, A-Z, 0-9</span>');
            hasError = true;
        }
        else if (lastname == '') {
            $("#lastname").after('<span class="error">Enter your last name</span>');
            hasError = true;
        }
        else if (!lastname.match(charRule)) {
            $("#lastname").after('<span class="error">Characters only consist of a-z, A-Z, 0-9</span>');
            hasError = true;
        }
        else if (email == '') {
            $("#email").after('<span class="error">Enter your email</span>');
            hasError = true;
        }
        else if (!email.match(emailRegex)) {
            $("#email").after('<span class="error">Email is not appropriate</span>');
            hasError = true;
        }
        else if (password == '') {
            $("#passowrd").after('<span class="error">Enter your password</span>');
            hasError = true;
        }
        else if (password.length < 6) {
            $("#password").after('<span class="error">Password must be at least 6 characters.</span>');
            hasError = true;
        }
        else if (password.length > 45) {
            $("#password").after('<span class="error">Password can not exceed 45 characters</span>');
            hasError = true;
        }
        else if (confirmPassword == '') {
            $("#confirmPassword").after('<span class="error">Enter your confirm password</span>');
            hasError = true;
        }
        else if (confirmPassword != password) {
            $("#confirmPassword").after('<span class="error">Password and confirm password do not match.</span>');
            hasError = true;
        }
        if (hasError == true) {
            return false;
        }
    
        
         $.ajax({
             type: "POST",
             url: "http://localhost:8080/miniblog/v1/users/register",
             contentType: 'application/json',
             data: JSON.stringify({'username': username, 'firstname': firstname, 'lastname': lastname, 'email': email, 'password': password, 'image': image}),
             statusCode: {
                1001: function() {
                    alert("Input failed. Characters only consist of a-z, A-Z, 0-9");
                },
                2009: function() {
                    alert("Username already existed.");
                },
                2010: function() {
                    alert("Email already in used");
                },
                9001: function() {
                    alert("Error");
                }
             },
             success: function(response, status, xhr) {
                if (status == "success") {
                    alert("Register success");
                    var now = new Date();
				    var time = now.getTime();
				    var expired = time + 12 * 60 * 60 * 1000;
                    now.setTime(expired);
                    document.cookie = 'token='+response['data']['access_token']+';expires='+now.toGMTString()+';';
                    document.cookie = 'userid=' + response['data']['id'] + ';expires='+now.toGMTString()+';';
                    document.cookie = 'username=' + response['data']['username'] + ';expires='+now.toGMTString()+';';
                    window.location = 'home.html'
                }
             }
         })
           
    })
    
    $("#cancel").click(function() {
        window.location.reload();
        return;
    })
    
    
    
</script>
        
</body>
</html>