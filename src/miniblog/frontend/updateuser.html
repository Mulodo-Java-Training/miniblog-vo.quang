<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />

<link rel="stylesheet" type="text/css" href="css/bootstrap.css">
<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="css/updateuser.css">

<script src="js/jquery-1.11.2.min.js"></script>
<script src="js/getCookie.js"></script>
<script src="js/logout.js"></script>    
<script src="js/config.js"></script>    
<script src="js/bootstrap.min.js"></script>
<script src="js/bootstrap.js"></script>

</head>
<body>
	<div class="container">
		<div class="group1">
			<div classs="row">
				<div class="col-xs-3 col-sm-3 col-md-3 miniblog">
                    <a class="remove-underline logo-color" href="home.html">Mini Blog</a></div>
				<div class="col-xs-3 col-sm-3 col-md-3 pull-right">	
					<span id="updateuser">Hi <a href="#" id="user"></a><span>
					<span><a href="#" onclick="logout()">Logout</a></span>
				</div>				
			</div>
		</div>

		<hr>

		<div class="group3">
			<div class="row">
				<div class="col-xs-4 col-xs-offset-4">
					<h2><span>Edit User Info</span></h2>
					<br/>
				</div>
			</div>
			<div class="row">
				<div class="col-xs-5 col-xs-offset-4">
				</div>
			</div>
			<div class="row">
				<div id="frm-change-pass" class="form-group col-xs-offset-2">
					<div class="col-xs-4 inline-block move-down">
						<span>Username</span>
					</div>
					<div class="col-xs-8 col-sm-8 col-md-8 inline-block  move-down">
						<input id="username" type="text" class="form-control" placeholder="Enter username..." />
					</div>
					<div class="col-xs-4  inline-block move-down">
						<span>First name</span>
					</div>
					<div class="col-xs-8 inline-block  move-down">
						<input id="fname" type="text" class="form-control" placeholder="Enter first name..." />
					</div>
					<div class="col-xs-4  inline-block move-down">
						<span>Last name</span>
					</div>
					<div class="col-xs-8  inline-block  move-down">
						<input id="lname" type="text" class="form-control" placeholder="Enter last name..." />
					</div>
					<div class="col-xs-4  inline-block move-down">
						<span>Email</span>
					</div>
					<div class="col-xs-8  inline-block  move-down">
						<input id="email" type="email" class="form-control" readonly />
					</div>
					<div class="col-xs-4  inline-block move-down">
						<span>Avatar</span>
					</div>
					<div class="col-xs-8  inline-block  move-down">
						<div class="row">
							<div class="col-xs-10">
								<input id="image" type="text" class="form-control" placeholder="url..." />
							</div>
							<div class="col-xs-2 cog">
								<span class="glyphicon glyphicon-cog"></span>
							</div>	
						</div>
						
					</div>
					<div class="inline-block move-left ">
						<button id="save" type="submit" class="btn btn-default">Save</button>
					</div>
					<div class="inline-block">
						<button id="cancel" class="btn btn-default">Cancel</button>
					</div>					
				</div>
			</div>
		</div>	
	</div>		
</div>

<script type="text/javascript">
    
    
    $(document).ready(function() {
        // Display username
        var user = getCookie('username');
        $("#user").html(user);
        
        // Get user info -> display
        var id = getCookie("userid");
        $.ajax({
            type: "GET",
            url: $apiadd+"users/"+id,
            statusCode: {
                9001: function() {
                    alert("Error");    
                }},
            success: function(response, status, xhr) {
                if (status == "success") {
                    var username = response['data']['username'];
                    var fname = response['data']['firstname'];
                    var lname = response['data']['lastname'];
                    var email = response['data']['email'];
                    var image = response['data']['image'];
                        
                    $("#username").val(username);
                    $("#fname").val(fname);
                    $("#lname").val(lname);
                    $("#email").val(email);
                    $("#image").val(image); 
                }                
            }
        })
    })
    
    // Update user's info
    $("#save").click(function() {
        // Get user's data
        var username = $("#username").val();
        var fname = $("#fname").val();
        var lname = $("#lname").val();
        var image = $("#image").val();
        var id = getCookie("userid");

        username = $.trim(username);
        fname = $.trim(fname);
        lname = $.trim(lname);

        // Validate
        $(".error").hide();
        var hasError = false;

        if (username == '') {
            $("#username").after('<span class="error">Enter your username</span>');
            hasError = true;
        }
        else if (fname == '') {
            $("#fname").after('<span class="error">Enter your first name</span>');
            hasError = true;
        }
        else if (lname == '') {
            $("#lname").after('<span class="error">Enter your last name</span>');
            hasError = true;
        }
        if (hasError == true) {
            return false;
        }
        
         $.ajax({
             type: "PUT",
             url: $apiadd+"users/"+id,
             beforeSend: function(request) {
                request.setRequestHeader("access_token", getCookie('token')); 
             },
             contentType: 'application/json',
             data: JSON.stringify({'username': username, 'firstname': fname, 'lastname': lname, 'image': image}),
             statusCode: {
                1002: function() {
                    alert("Token has expired!");
                    window.location = 'welcome.html';
                },
                1001: function() {
                    alert("Input failed.");
                },
                9001: function() {
                    alert("Error");
                }
             },
             success: function(response, status, xhr) {
                if (status != "success") {
                    alert("Unknown...");
                    window.location.reload();
                }
                else {
                    alert("User updated success");
                    window.location = "home.html";
                }
                 
             }
         })
           
    })
       
    $("#cancel").click(function() {
        window.location.reload();
        return;
    })
        
        
</script>        
        

</body>
</html>