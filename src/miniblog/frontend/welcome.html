<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />

<link rel="stylesheet" type="text/css" href="css/bootstrap.css">
<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="css/welcome.css">

<script src="js/jquery-1.11.2.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/bootstrap.js"></script>

</head>
<body>
	<div class="container">
		<div class="group1">
			<div class="col-xs-3 col-sm-3 col-md-3 miniblog">
				<a class="remove-underline" href="welcome.html">Mini Blog</a>
			</div>
			<div class="col-xs-3 col-sm-3 col-md-3 pull-right">	
				<div id="frmLogin">			
					<div>
						<input id="username" type="text" class="form-control" placeholder="Username..." required />
					</div>
					<div id="pass"><input id="password" type="password" class="form-control" placeholder="Password..."  required /></div>
					<button id="submit" class="btn btn-default" onclick="login();">Login</button>
				</div>			
			</div>
		</div>
		<div class="group2">
			<div id="frmSearch">
				<div class="move-left">
<!--
					<div class="col-xs-6 col-sm-6 col-md-6 inline-block pull-left ">
						<input type="text" class="form-control" placeholder="Search username, firstname, lastname..." />
					</div>
					<div class="btnSearch inline-block pull-left search">
						 <button class="btn btn default" id="submit">Search</button> 
						<span class="glyphicon glyphicon-search"></span>
					</div>
-->
					<div class="register pull-right">
						<span class="inline-block"><a href="register.html">Register an account </a></span>
						<!-- <div class="inline-block"><button id="submit" class="btn btn-default">Register</button></div> -->
					</div>
				</div>
			</div>
		</div>

		<hr>

		<div class="group3">
            <div class="row">
				<div class="col-xs-4 col-xs-offset-5">
					<h2><span>Welcome</span></h2>
					<br/>
				</div>
			</div>
			<div class=" row latest-post">
				<span>10 latest Posts</span>
			</div>
			<div class="row" id="post">
                
			</div>
		</div>		
	</div>

<script type="text/javascript">
    
    // Get 10 latest posts
    $(document).ready(function() {
        
        $.ajax({
            type: "GET",
            url: "http://localhost:8080/miniblog/v1/posts/getlatestpost",
            statusCode: {
                9001: function() {
                    alert('Error');
                    window.location.reload();
                }
            },
            success: function(response, status, xhr) {
                if (status == 'success') {
                    // i variable used to count post
                    var i = 0;
                    $.each(response['data'], function(key, value) {
                        i++;
                        $("#post").append("\
                        <div class='row post' >\
                        <div class='col-xs-12 col-sm-12 col-md-12'>\
                            <div class='col-xs-2 col-sm-2 col-md-2 inline-block'>\
                                <a href='#'><img src='image/image3.jpg' class='img-responsive' alt='Cinque Terre'></a>\
                            </div>\
                            <div class='col-xs-10 col-sm-10 col-md-10 inline-block blog-main'>\
                                <div class=' justify'>"+i+")\
                                    <a href='#'><span id='title'>"+value['title']+"</span></a>\
                                </div>\
                                <div class=' blog-post-meta justify' id='created_at'><small>Created at: "+value['created_at_fm']+" | Author: <b>"+value['user']['username']+"</b></small>\
                                </div>\
                                <div class=' justify' id='description'>"+value['description']+"</div>\
                            </div>\
                        </div>\
                    </div>"               
                                    );
                          
                    });
                }
            }
            
        })
    })
    
    

 function login() {
		var username = $("#username").val();
		var password = $("#password").val();

		username = $.trim(username);
		password = $.trim(password);

			$.ajax({
				type: "POST",
				url: "http://localhost:8080/miniblog/v1/users/login",
				data:"username=" + username + "&password=" + password,
				statusCode: {
					1001: function() {
						alert('Input failed');
						window.location.reload();
						return;
					},
					9001: function() {
						alert('Invalid username and password');
						window.location.reload();
						return;
					}
				},
				success: function(response, status, xhr) {
					if (status != "success") {
						alert('Error');
				        window.location.reload();
						return;
					}
					else {
						var now = new Date();
						var time = now.getTime();
						var expired = time + 12 * 60 * 60 * 1000;
						now.setTime(expired);
                        document.cookie = 'token='+response['data']['access_token']+';expires='+now.toGMTString()+';';
						document.cookie = 'userid=' + response['data']['id'] + ';expires='+now.toGMTString()+';';
                        document.cookie = 'username=' + response['data']['username'] + ';expires='+now.toGMTString()+';';
						window.location = 'home.html';
						
					}
				}
			});
		 }
        
    
</script>

</body>
</html>